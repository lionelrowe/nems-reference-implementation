<template>

    <section class="container">
        <h1 class="h1">${heading}</h1>

        <form>
            <!--<div class="form-group">
        <label for="patient">Patient</label>
        <select value.bind="selectedPatient" class="form-control" id="patient">
            <option model.bind="null">--select--</option>
            <option repeat.for="patient of patients" model.bind="patient">${patient.displayName} (${patient.nhsNumber})</option>
        </select>
    </div>-->
            <div class="form-group">
                <label for="eventMessageType">Event message type</label>
                <spinner-msg message="Loading Event Types" logic.one-way="!eventMessageTypes || eventMessageTypes.length === 0"></spinner-msg>
                <select value.bind="selectedEventMessageType" class="form-control" id="eventMessageType" show.bind="eventMessageTypes && eventMessageTypes.length > 0">
                    <!--disabled.bind="!selectedPatient">-->
                    <option model.bind="null">--select--</option>
                    <option repeat.for="eventMessageType of eventMessageTypes" model.bind="eventMessageType" selected>${eventMessageType.value}</option>
                </select>
            </div>
            <div class="form-group">
                <label for="messageFormat">Message Format</label>
                <spinner-msg message="Loading Format Types" logic.one-way="!exampleMessageFormats || exampleMessageFormats.length === 0"></spinner-msg>
                <select value.bind="selectedExampleMessageFormat" class="form-control" id="messageFormat" disabled.bind="!selectedEventMessageType" show.bind="exampleMessageFormats && exampleMessageFormats.length > 0">
                    <option repeat.for="exampleMessageFormat of exampleMessageFormats" model.bind="exampleMessageFormat">${exampleMessageFormat.value}</option>
                </select>
            </div>

            <div class="form-group" show.bind="selectedEventMessageType">
                <label for="Endpoint">Request</label>
                <div class="well well-content-break">
                    <b>Endpoint</b>
                    <pre>POST ${publishRequest.endPoint}</pre>

                    <b>Headers</b>
<pre>
fromASID: ${publishRequest.fromAsid}
toASID: ${publishRequest.toAsid}
InteractionID: ${publishRequest.interactionId}
Content-Type: ${publishRequest.contentType}
Authorization: Bearer ${publishRequest.jwt}
</pre>


                    <b>Body</b>
                    <pre class="examples">${exampleMessageBody}</pre>
                </div>
            </div>

            <div class="form-group" show.bind="!publishRequest.running && response">
                <label for="Endpoint">Response</label>
                <div class="well well-content-break">
                    <b>Status</b>
                    <pre>${response.statusCode} ${response.statusText}</pre>

                    <b>Headers</b>
<pre><span repeat.for="key of response.headers | keys">${key}: ${response.headers[key]}
</span></pre>

                    <b>Body<span show.bind="response.body.length === 0"> (<span class="text-warning">no body returned</span>)</span></b>
                    <pre class="examples" show.bind="response.body.length > 0">${response.body}</pre>
                </div>

                <label for="Endpoint">Message Receiver Mailboxes</label>
                <div class="alert alert-warning" role="alert">
                    <p><i class="fa fa-exclamation-triangle text-warning"></i> Publishers who publish messages using the NEMS do not get notification of which organisations or mailboxes will receieve their message.</p>
                    <p>We have included it here though to help demonstrate the concept that a variety of mailboxes may receive messages sent using the NEMS.</p>
                </div>

                <div class="well">
                    <p show.bind="!receiverMailboxIds || receiverMailboxIds.length === 0"><i class="fa fa-exclamation-triangle text-warning"></i> No Subscribers for this message are listed. Create a <a route-href="route: subscriber;">subscription</a> for the correct criteria.</p>

                    <div show.bind="receiverMailboxIds && receiverMailboxIds.length > 0">
                        <p>The following subscriber MESH mail boxes will receive sent message.</p>
                        <ul class="fa-ul">
                            <li repeat.for="id of receiverMailboxIds"><i class="fa-li fa fa-check text-success"></i>${id}</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-2">
                    <button type="submit" click.delegate="sendEvent()" class="btn btn-success btn-block" disabled.bind="!selectedEventMessageType">Send</button>
                </div>
                <div class="col-xs-2">
                    <spinner-msg message="Sending Request" logic.one-way="!response && publishRequest.running"></spinner-msg>
                </div>
            </div>
        </form>
    </section>
</template>
